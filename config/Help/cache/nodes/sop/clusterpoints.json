{"body": [{"indent": 0, "text": ["Cluster Points"], "type": "title", "extent": [0, 19], "level": 0}, {"indent": 0, "type": "summary", "extent": [120, 215], "text": ["Higher-level node to cluster points based on their positions (or any vector attribute)."]}, {"body": [{"indent": 0, "type": "para", "extent": [230, 456], "text": ["This is a higher-level node that can output clustered points with a cluster attribute and optionally cluster center points. For the lower-level clustering node this node is based on, see the ", {"text": ["Cluster node"], "fullpath": "/nodes/sop/cluster", "scheme": "Node", "type": "link", "value": "/nodes/sop/cluster"}, "."]}, {"indent": 0, "type": "para", "extent": [456, 644], "text": ["This node creates a ", {"text": ["cluster"], "type": "code"}, " integer attribute on the points which indicates the cluster number the point belongs to (all points in the same cluster will have the same ", {"text": ["cluster"], "type": "code"}, " value)."]}, {"indent": 0, "type": "para", "extent": [644, 727], "text": ["This node uses the ", {"text": ["K-means clustering algorithm"], "scheme": "Wp", "type": "link", "exists": true, "value": "http://en.wikipedia.org/wiki/K-means"}, " to group the points."]}, {"body": [{"indent": 0, "type": "para", "extent": [1104, 1545], "text": ["The K-means clustering algorithm used by this node is sensitive to the randomly chosen initial cluster centers, especially when you create a small number of clusters. For example, if you have geometry divided into two parts that are far from each other, you might end up with all the points of part A in one cluster, and the points of part B divided into many clusters, just because none of the initial centers happened to be near part A."]}, {"indent": 0, "type": "para", "extent": [1545, 1603], "text": [{"text": "", "fullpath": "/images/nodes/sop/clusterpoints_bad_clusters.png", "scheme": "Image", "type": "link", "value": "/images/nodes/sop/clusterpoints_bad_clusters.png"}]}, {"indent": 0, "type": "para", "extent": [1603, 1690], "text": ["In this case you can change the ", {"text": ["Seed"], "type": "ui"}, " parameter until you get a better clustering."]}], "indent": 0, "level": 3, "text": ["Change the Seed to change the clustering"], "extent": [1047, 1104], "container": true, "type": "h", "id": "seeding"}, {"body": [{"type": "para", "indent": 0, "extent": [1728, 2000], "text": ["This node lets you cluster by blending multiple attributes (by increasing the ", {"text": ["Control attributes"], "type": "ui"}, " parameter). Each attribute has a ", {"text": ["Weight"], "type": "ui"}, " parameter controlling its linear contribution to the proximity measurement that controls which cluster each point goes into."]}, {"type": "para", "indent": 0, "extent": [2000, 2178], "text": ["For some attributes, you may find that a linear scale is not what you want. The example that motivated the threshold feature is clustering points by ", {"text": ["impact time"], "type": "em"}, ". For example:"]}, {"body": [{"type": "bullet", "blevel": 2, "indent": 0, "extent": [2178, 2423], "text": ["You use an ", {"text": ["Impact Analysis DOP"], "fullpath": "/nodes/dop/impactanalysis", "scheme": "Node", "type": "link", "value": "/nodes/dop/impactanalysis"}, " to create points where RBD objects hit the ground, in order to create dust clouds. The impact points have an ", {"text": ["impacttime"], "type": "code"}, " attribute containing a time stamp of when the impact occurred."]}, {"type": "bullet", "blevel": 2, "indent": 0, "extent": [2423, 2512], "text": ["You want to cluster the impact points to put them in separate fluid simulation boxes."]}, {"type": "bullet", "blevel": 2, "indent": 0, "extent": [2512, 2748], "text": ["You want to sort by location (so points close to each other are in the same box), but also by ", {"text": ["impact time"], "type": "em"}, " (so impact points that occur far apart from each other in time are in separate boxes, even if they occur at the same place)."]}, {"type": "bullet", "blevel": 2, "indent": 0, "extent": [2748, 2949], "text": ["You could use two \"control attributes\", position (", {"text": ["P"], "type": "code"}, ") and ", {"text": ["impacttime"], "type": "code"}, ", to control clustering, with a higher ", {"text": ["Weight"], "type": "ui"}, " value for ", {"text": ["impacttime"], "type": "code"}, " to group the points by impact time, then by position."]}, {"type": "bullet", "blevel": 2, "indent": 0, "extent": [2949, 3198], "text": ["However, the linear nature of the ", {"text": ["Weight"], "type": "ui"}, " parameter may make it difficult to pick the right weight value to get the behavior you want, where impacts that are \"close enough\" in time go into the same box, but otherwise are clustered separately."]}], "type": "bullet_group", "container": true}, {"type": "para", "indent": 0, "extent": [3198, 3424], "text": ["This is what the threshold feature is useful for. Instead of a linear weight, it adds a high \"penalty\" to the final distance calculation if the distance of a certain attribute is more than a certain amount (the ", {"text": ["threshold"], "type": "em"}, ")."]}, {"type": "para", "indent": 0, "extent": [3424, 3469], "text": [{"text": "", "fullpath": "/nodes/images/cluster_threshold.png", "scheme": "Image", "type": "link", "value": "/nodes/images/cluster_threshold.png"}]}, {"type": "para", "indent": 0, "extent": [3469, 3710], "text": ["In this example, the red points represent early impacts, and the green points represent later impacts. You can see that in some places points impacts that overlap in position are sorted into different boxes based on different impact times."]}, {"type": "para", "indent": 0, "extent": [3710, 3746], "text": [{"text": "", "fullpath": "/images/cluster_impact.png", "scheme": "Image", "type": "link", "value": "/images/cluster_impact.png"}]}], "container": true, "level": 3, "text": ["Threshold attribute"], "extent": [1690, 1728], "indent": 0, "type": "h", "id": "threshold"}], "indent": 0, "level": 2, "text": ["Overview"], "extent": [215, 230], "container": true, "type": "h", "id": null}, {"body": [{"body": [{"body": [{"indent": 4, "type": "para", "extent": [811, 991], "text": ["The input points to sort into clusters. This node will create an attribute (by default called ", {"text": ["cluster"], "type": "code"}, ") on each point containing the cluster number the point belongs to."]}], "indent": 0, "type": "dt", "extent": [791, 811], "text": ["Points to cluster"]}, {"body": [{"indent": 4, "type": "para", "extent": [1006, 1305], "text": ["Calculate the cluster centers based on the points in this input instead of the points to cluster. This is useful for calculating the cluster centers from a decimated point cloud (for performance) or from the point positions at a different frame (using the ", {"text": ["Timeshift node"], "fullpath": "/nodes/sop/timeshift", "scheme": "Node", "type": "link", "value": "/nodes/sop/timeshift"}, ")."]}], "indent": 0, "type": "dt", "extent": [991, 1006], "text": ["Rest Position"]}], "container": true, "type": "dt_group"}], "indent": 0, "level": 1, "text": "Inputs", "role": "section", "extent": [783, 791], "container": true, "type": "inputs_section", "id": "inputs"}, {"body": [{"body": [{"body": [{"type": "para", "indent": 4, "extent": [4399, 4547], "text": ["The name of the attribute to set on the points. This attribute will contain the cluster number the point belongs to. The default is ", {"text": ["cluster"], "type": "code"}, "."]}], "indent": 0, "text": ["Output Attribute"], "role": "item", "attrs": {"id": "attrib_name"}, "extent": [1317, 1336], "type": "parameters_item"}, {"body": [{"indent": 4, "type": "para", "extent": [1411, 1588], "text": ["Whether to output clustered points, cluster centers with ", {"text": ["scale"], "type": "code"}, " attribute, both clustered points and cluster centers in groups, or the bounding boxes of the clusters."]}, {"body": [{"body": [{"indent": 8, "type": "para", "extent": [1608, 1736], "text": ["Output the input points with a cluster attribute on each point containing the cluster number the point belongs to."]}], "indent": 4, "type": "dt", "extent": [1588, 1608], "text": ["Cluster points"]}, {"body": [{"indent": 8, "type": "para", "extent": [1756, 1908], "text": ["Output the cluster centers as points. The points have a ", {"text": ["scale"], "type": "code"}, " vector attribute describing the bounding box of the points in the cluster."]}], "indent": 4, "type": "dt", "extent": [1736, 1756], "text": ["Average points"]}, {"body": [{"indent": 8, "type": "para", "extent": [1918, 2072], "text": ["Outputs both the clustered input points (in a group named ", {"text": ["clusterpoints"], "type": "code"}, ") and the cluster center points (in a group named ", {"text": ["averagepoints"], "type": "code"}, ")."]}], "indent": 4, "type": "dt", "extent": [1908, 1918], "text": ["Both"]}, {"body": [{"indent": 8, "type": "para", "extent": [2083, 2133], "text": ["Outputs bounding boxes for the clusters."]}], "indent": 4, "type": "dt", "extent": [2072, 2083], "text": ["Boxes"]}], "container": true, "type": "dt_group"}], "indent": 0, "text": ["Output"], "role": "item", "extent": [1403, 1411], "type": "parameters_item"}, {"body": [{"indent": 4, "type": "para", "extent": [2147, 2209], "text": ["Add random color (", {"text": ["Cd"], "type": "code"}, ") attributes to cluster of points."]}, {"body": [{"body": [{"indent": 8, "type": "para", "extent": [2221, 2254], "text": ["Do not color the points."]}], "indent": 4, "type": "dt", "extent": [2209, 2221], "text": ["Points"]}, {"body": [{"indent": 8, "type": "para", "extent": [2277, 2487], "text": ["Color the points by cluster and create a particle system out of them.\n        This option is for backwards compatibility with versions where\n        points were only displayed when in particle systems."]}], "indent": 4, "type": "dt", "extent": [2254, 2277], "text": ["Colored Particles"]}, {"body": [{"indent": 8, "type": "para", "extent": [2507, 2545], "text": ["Color the points by cluster."]}], "indent": 4, "type": "dt", "extent": [2487, 2507], "text": ["Colored Points"]}], "container": true, "type": "dt_group"}], "indent": 0, "text": ["Color Output"], "role": "item", "extent": [2133, 2147], "type": "parameters_item"}, {"body": [{"indent": 4, "type": "para", "extent": [2561, 2723], "text": ["Only outputs clusters where the cluster number matches this pattern. For example, setting this to ", {"text": ["3 4"], "type": "code"}, " will only output the points in clusters 3 and 4."]}, {"indent": 4, "type": "para", "extent": [2723, 2929], "text": ["The pattern can use the same ", {"fragment": "#manual", "text": ["pattern matching syntax"], "value": "/model/groups#manual", "fullpath": "/model/groups#manual", "scheme": null, "type": "link"}, " as other surface nodes that let you specify point/primitive numbers. For example, ", {"text": ["3-6"], "type": "code"}, " will output clusters 3, 4, 5, and 6."]}], "indent": 0, "text": ["Cluster Filter"], "role": "item", "extent": [2545, 2561], "type": "parameters_item"}, {"body": [{"type": "para", "indent": 4, "extent": [5185, 5417], "text": ["The number of vector attributes to blend together to determine which points should be grouped together. The default is to use the position attribute (", {"text": ["P"], "type": "code"}, "), so the node will cluster together points that are near each other."]}], "indent": 0, "text": ["Control Attributes"], "role": "item", "attrs": {"id": "num_controls"}, "extent": [5138, 5158], "type": "parameters_item"}, {"body": [{"type": "para", "indent": 4, "extent": [5465, 5600], "text": ["The name of a vector attribute to use to cluster points. Points with close values of this attribute will be grouped together."]}], "indent": 0, "text": ["Control Attribute"], "role": "item", "attrs": {"id": "control_attrib"}, "extent": [5417, 5436], "type": "parameters_item"}, {"body": [{"type": "para", "indent": 4, "extent": [5637, 5837], "text": ["The strength of a particular vector attribute in controlling which points should be grouped together. This is a linear scale. For a more discrete grouping method, use the ", {"fragment": "#threshold", "text": ["threshold"], "value": "#threshold", "fullpath": "/nodes/sop/cluster#threshold", "scheme": null, "type": "link"}, "."]}], "indent": 0, "text": ["Weight"], "role": "item", "attrs": {"id": "control_weight"}, "extent": [5600, 5608], "type": "parameters_item"}], "container": true, "role": "item_group", "type": "parameters_item_group"}, {"body": [{"body": [{"body": [{"indent": 4, "type": "para", "extent": [3069, 3304], "text": ["If the incoming geometry already has a point attribute with the specified\n    output name, you can skip cluster building and just use it.  This allows you to take advantage of the other options for setting up cluster simulations."]}], "indent": 0, "text": ["Build Clusters"], "role": "item", "extent": [3052, 3069], "type": "parameters_item"}, {"body": [{"type": "para", "indent": 4, "extent": [4287, 4351], "text": ["The number of clusters to group the input points into."]}], "indent": 0, "text": ["Clusters"], "role": "item", "attrs": {"id": "num_clusters"}, "extent": [4249, 4260], "type": "parameters_item"}, {"body": [{"type": "para", "indent": 4, "extent": [6273, 6370], "text": ["Changing this will usually generate different groupings and cluster number assignments."]}, {"type": "para", "indent": 4, "extent": [6370, 6558], "text": ["The K-means clustering algorithm starts with random cluster centers and then iterates to refine the cluster centers. Changing the initial positions can potentially change the groups."]}], "indent": 0, "text": ["Seed"], "role": "item", "attrs": {"id": "random_seed"}, "extent": [6241, 6247], "type": "parameters_item"}, {"body": [{"type": "para", "indent": 4, "extent": [5874, 5956], "text": ["Higher numbers give more accurate clustering but take longer to compute."]}, {"type": "para", "indent": 4, "extent": [5956, 6241], "text": ["The K-means clustering algorithm starts with random cluster centers, assigns points to clusters based on their distance from the centers, then moves to centers based on the points in the cluster and repeats. This iterative process usually converges toward more accurate clusters."]}], "indent": 0, "text": ["Refinement iterations"], "role": "item", "attrs": {"id": "iterations"}, "extent": [3367, 3390], "type": "parameters_item"}, {"body": [{"type": "para", "indent": 4, "extent": [6610, 6872], "text": ["Use the value of this float or integer attribute as a ", {"fragment": "#threshold", "text": ["threshold"], "value": "#threshold", "fullpath": "/nodes/sop/cluster#threshold", "scheme": null, "type": "link"}, ", where points that aren\u2019t \"close enough\" (within the ", {"text": ["Goal threshold"], "type": "ui"}, ") in this attribute will not be grouped together, even if they are close according to the control attribute."]}], "indent": 0, "text": ["Threshold Attribute"], "role": "item", "attrs": {"id": "threshold_attrib"}, "extent": [6558, 6579], "type": "parameters_item"}, {"body": [{"type": "para", "indent": 4, "extent": [6911, 7008], "text": ["The strength of the ", {"text": ["Threshold Attribute"], "type": "ui"}, ". Set this to ", {"text": ["0"], "type": "code"}, " to turn off the threshold."]}], "indent": 0, "text": ["Weight"], "role": "item", "attrs": {"id": "threshold_weight"}, "extent": [6872, 6880], "type": "parameters_item"}, {"body": [{"type": "para", "indent": 4, "extent": [7059, 7388], "text": ["The initial \"cutoff\" value of the threshold attribute, used in the first clustering iteration. The threshold value works better if it\u2019s high at first (so the control attribute dominates) and lowers toward the ", {"text": ["Goal threshold"], "type": "ui"}, " at each iteration. As a rule of thumb, start by setting this to 4 times the ", {"text": ["Goal threshold"], "type": "ui"}, "."]}], "indent": 0, "text": ["Initial Threshold"], "role": "item", "attrs": {"id": "initial_threshold"}, "extent": [7008, 7027], "type": "parameters_item"}, {"body": [{"type": "para", "indent": 4, "extent": [7434, 7623], "text": ["The \"cutoff\" value of the threshold attribute, used in the final clustering iteration. Points with values farther apart than this value will be unlikely to end up in the same cluster."]}], "indent": 0, "text": ["Goal Threshold"], "role": "item", "attrs": {"id": "final_threshold"}, "extent": [7388, 7404], "type": "parameters_item"}], "container": true, "role": "item_group", "type": "parameters_item_group"}], "indent": 0, "level": 2, "text": ["Cluster settings"], "extent": [3029, 3052], "container": true, "type": "h", "id": null}, {"body": [{"body": [{"body": [{"indent": 4, "type": "para", "extent": [3662, 3796], "text": ["The average points representing the clusters will have the attributes\n    of the cluster points attribute transferred onto them."]}], "indent": 0, "text": ["Copy point attributes from cluster"], "role": "item", "extent": [3625, 3662], "type": "parameters_item"}, {"body": [{"indent": 4, "type": "para", "extent": [3814, 3951], "text": ["The number of nearest points to contribute to the point attribute\n    of the center.  A value of 1 will just use the closest point."]}], "indent": 0, "text": ["Max Sample Count"], "role": "item", "extent": [3796, 3814], "type": "parameters_item"}, {"body": [{"indent": 4, "type": "para", "extent": [3972, 4184], "text": ["When ", {"text": ["Output"], "type": "ui"}, " is \"Average points\" or \"Both\", the node adds a vector attribute with this name to the cluster center points, describing the bounding box of the points in the cluster. The default is ", {"text": ["scale"], "type": "code"}, "."]}], "indent": 0, "text": ["Size Attribute name"], "role": "item", "extent": [3951, 3972], "type": "parameters_item"}, {"body": [{"indent": 4, "type": "para", "extent": [4220, 4375], "text": ["Amount of padding to add to the negative X, negative Y, and negative Z sides of bounding boxes and/or the ", {"text": ["scale"], "type": "code"}, " attribute on cluster center points."]}], "indent": 0, "text": ["Padding min"], "role": "item", "attrs": {"id": "size_padding"}, "extent": [4184, 4197], "type": "parameters_item"}, {"body": [{"indent": 4, "type": "para", "extent": [4416, 4571], "text": ["Amount of padding to add to the positive X, positive Y, and positive Z sides of bounding boxes and/or the ", {"text": ["scale"], "type": "code"}, " attribute on cluster center points."]}], "indent": 0, "text": ["Padding max"], "role": "item", "attrs": {"id": "size_padding2"}, "extent": [4375, 4388], "type": "parameters_item"}], "container": true, "role": "item_group", "type": "parameters_item_group"}], "indent": 0, "level": 2, "text": ["Averaging settings"], "extent": [3600, 3625], "container": true, "type": "h", "id": null}], "indent": 0, "level": 1, "text": "Parameters", "role": "section", "extent": [1305, 1317], "container": true, "type": "parameters_section", "id": "parameters"}, {"body": [{"body": [{"indent": 0, "blevel": 2, "type": "bullet", "extent": [4580, 4602], "text": [{"text": "", "fullpath": "/nodes/sop/cluster", "scheme": "Node", "type": "link", "value": "/nodes/sop/cluster"}]}, {"indent": 0, "blevel": 2, "type": "bullet", "extent": [4602, 4625], "text": [{"text": "", "fullpath": "/nodes/sop/partition", "scheme": "Node", "type": "link", "value": "/nodes/sop/partition"}]}, {"indent": 0, "blevel": 2, "type": "bullet", "extent": [4625, 4653], "text": [{"text": "", "fullpath": "/nodes/dop/impactanalysis", "scheme": "Node", "type": "link", "value": "/nodes/dop/impactanalysis"}]}], "container": true, "type": "bullet_group"}], "indent": 0, "level": 1, "text": "Related", "role": "section", "extent": [4571, 4580], "container": true, "type": "related_section", "id": "related"}], "title": ["Cluster Points"], "summary": ["Higher-level node to cluster points based on their positions (or any vector attribute)."], "attrs": {"version": null, "tags": "cluster, points", "namespace": null, "internal": "clusterpoints", "context": "sop", "type": "node", "icon": "SOP/clusterpoints"}, "included": ["/nodes/sop/cluster"], "type": "root"}